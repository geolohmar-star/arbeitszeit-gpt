<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        
        body {
            font-family: Arial, sans-serif;
            font-size: 12pt;
            color: #333;
        }
        
        h1 {
            color: #1a4d2e;
            text-align: center;
            margin-bottom: 2cm;
        }
        
        h2 {
            color: #1a4d2e;
            margin-top: 1cm;
            border-bottom: 2px solid #1a4d2e;
            padding-bottom: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1cm 0;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        th {
            background-color: #1a4d2e;
            color: white;
            font-weight: bold;
        }
        
        .info-table td:first-child {
            background-color: #E8F5E9;
            font-weight: bold;
            width: 40%;
        }
        
        .footer {
            margin-top: 3cm;
            font-size: 10pt;
            color: #666;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Arbeitszeitvereinbarung</h1>
    
    <p><strong>Betreff:</strong> Flexible Arbeitszeit
    {% if vereinbarung.antragsart == 'weiterbewilligung' %} - Weiterbewilligung
    {% elif vereinbarung.antragsart == 'verringerung' %} - Verringerung
    {% elif vereinbarung.antragsart == 'erhoehung' %} - Erhöhung
    {% elif vereinbarung.antragsart == 'beendigung' %} - Beendigung
    {% endif %}
    </p>
    
    <h2>Stammdaten</h2>
    <table class="info-table">
        <tr>
            <td>Personalnummer</td>
            <td>{{ vereinbarung.mitarbeiter.personalnummer }}</td>
        </tr>
        <tr>
            <td>Name</td>
            <td>{{ vereinbarung.mitarbeiter.vollname }}</td>
        </tr>
        <tr>
            <td>Abteilung</td>
            <td>{{ vereinbarung.mitarbeiter.abteilung }}</td>
        </tr>
        <tr>
            <td>Standort</td>
            <td>{{ vereinbarung.mitarbeiter.standort.name }}</td>
        </tr>
        <tr>
            <td>Eintrittsdatum</td>
            <td>{{ vereinbarung.mitarbeiter.eintrittsdatum|date:"d.m.Y" }}</td>
        </tr>
    </table>
    
    <h2>Vereinbarungsdetails</h2>
    <table class="info-table">
        <tr>
            <td>Antragsart</td>
            <td>{{ vereinbarung.get_antragsart_display }}</td>
        </tr>
        <tr>
            <td>Status</td>
            <td>{{ vereinbarung.get_status_display }}</td>
        </tr>
        <tr>
            <td>Beantragt am</td>
            <td>{{ vereinbarung.created_at|date:"d.m.Y H:i" }} Uhr</td>
        </tr>
        {% if vereinbarung.arbeitszeit_typ %}
        <tr>
            <td>Arbeitszeit-Typ</td>
            <td>{{ vereinbarung.get_arbeitszeit_typ_display }}</td>
        </tr>
        {% endif %}
        <tr>
            <td>Gültig ab</td>
            <td>{{ vereinbarung.gueltig_ab|date:"d.m.Y" }}</td>
        </tr>
        <tr>
            <td>Gültig bis</td>
            <td>{% if vereinbarung.gueltig_bis %}{{ vereinbarung.gueltig_bis|date:"d.m.Y" }}{% else %}unbefristet{% endif %}</td>
        </tr>
        <tr>
            <td>Telearbeit</td>
            <td>{% if vereinbarung.telearbeit %}Ja{% else %}Nein{% endif %}</td>
        </tr>
        {% if vereinbarung.genehmigt_von %}
        <tr>
            <td>Genehmigt von</td>
            <td>{{ vereinbarung.genehmigt_von.get_full_name }}</td>
        </tr>
        <tr>
            <td>Genehmigt am</td>
            <td>{{ vereinbarung.genehmigt_am|date:"d.m.Y H:i" }} Uhr</td>
        </tr>
        {% endif %}
    </table>
    
    {% if vereinbarung.wochenstunden %}
    <h2>Arbeitszeit</h2>
    <p><strong>{{ vereinbarung.wochenstunden }} Stunden pro Woche</strong></p>
    {% endif %}
    
    {% if wochen_daten %}
    <h2>Wochenverteilung</h2>
    
    {% for woche, data in wochen_daten.items %}
        <!-- Kasten für die Woche -->
        <div style="margin-bottom: 1cm; page-break-inside: avoid;">
            <h3 style="margin-bottom: 5px; color: #1a4d2e;">Woche {{ woche }}</h3>
            
            <table>
                <thead>
                    <tr>
                        <th style="width: 60%;">Wochentag</th>
                        <th style="text-align: right;">Arbeitszeit</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tag in data.tage %}
                    <tr>
                        <td>{{ tag.get_wochentag_display }}</td>
                        <td style="text-align: right;">{{ tag.display_zeit }} h</td>
                    </tr>
                    {% endfor %}
                    
                    <!-- Summenzeile pro Woche -->
                    <tr style="background-color: #f0f0f0;">
                        <td><strong>Summe Woche {{ woche }}</strong></td>
                        <td style="text-align: right;"><strong>{{ data.summe }} h</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
    {% endfor %}
    {% endif %}
    
    <p style="margin-top: 2cm;">
        Diese Vereinbarung gilt vom {{ vereinbarung.gueltig_ab|date:"d.m.Y" }} 
        bis {% if vereinbarung.gueltig_bis %}{{ vereinbarung.gueltig_bis|date:"d.m.Y" }}{% else %}unbefristet{% endif %}.
    </p>
    
    {% if vereinbarung.bemerkungen %}
    <h2>Bemerkungen</h2>
    <p>{{ vereinbarung.bemerkungen }}</p>
    {% endif %}
    
    <div style="margin-top: 3cm;">
        <p>Mit freundlichen Grüßen</p>
        <p style="margin-top: 2cm;">_______________________________</p>
        <p>Unterschrift</p>
    </div>
    
    <div class="footer">
        <p><em>Erstellt am: {% now "d.m.Y" %} um {% now "H:i" %} Uhr</em></p>
    </div>
</body>
</html>