{% if art == "haertefall" or art == "ehrenamt" %}
<!-- Haertefall / Ehrenamt: Dynamische Zeilen -->
<div class="mt-3">
    <h6 class="mb-2">Zeitraum(e)</h6>

    <div id="zeilen-container">
        <!-- Erste Zeile automatisch anzeigen -->
        {% include "formulare/partials/_zeitgutschrift_zeile.html" %}
    </div>

    <button type="button"
            class="btn btn-sm btn-outline-primary mt-2"
            hx-get="{% url 'formulare:neue_zeitgutschrift_zeile' %}"
            hx-target="#zeilen-container"
            hx-swap="beforeend">
        + Zeile hinzufuegen
    </button>
</div>

<!-- Belege-Upload (optional) -->
<div class="mt-4">
    <h6 class="mb-2">Belege (optional)</h6>
    <p class="text-muted small mb-2">
        PDF, JPG oder PNG, max. 10 MB pro Datei
    </p>
    <input type="file" name="belege" class="form-control" multiple accept=".pdf,.jpg,.jpeg,.png">
    {% if form.belege.errors %}
    <div class="text-danger small mt-1">{{ form.belege.errors.0 }}</div>
    {% endif %}
</div>

{% elif art == "fortbildung" %}
<!-- Fortbildung: Checkbox-gesteuerte Felder -->
<div class="mt-3">
    <div class="form-check mb-3">
        {{ form.fortbildung_aktiv }}
        <label class="form-check-label" for="{{ form.fortbildung_aktiv.id_for_label }}">
            Fortbildung aktivieren
        </label>
    </div>

    <div id="fortbildung-felder" style="display: none;">
        <!-- Typ -->
        <div class="mb-3">
            <label class="form-label fw-semibold">Typ</label>
            {% for choice in form.fortbildung_typ %}
            <div class="form-check">
                {{ choice.tag }}
                <label class="form-check-label" for="{{ choice.id_for_label }}">
                    {{ choice.choice_label }}
                </label>
            </div>
            {% endfor %}
            {% if form.fortbildung_typ.errors %}
            <div class="text-danger small mt-1">{{ form.fortbildung_typ.errors.0 }}</div>
            {% endif %}
        </div>

        <!-- Wochenstunden regulaer -->
        <div class="mb-3">
            <label class="form-label fw-semibold" for="{{ form.fortbildung_wochenstunden_regulaer.id_for_label }}">
                Wochenstunden regulaer
            </label>
            {{ form.fortbildung_wochenstunden_regulaer }}
            {% if form.fortbildung_wochenstunden_regulaer.errors %}
            <div class="text-danger small mt-1">{{ form.fortbildung_wochenstunden_regulaer.errors.0 }}</div>
            {% endif %}
        </div>

        <!-- Von Datum -->
        <div class="mb-3">
            <label class="form-label fw-semibold" for="{{ form.fortbildung_von_datum.id_for_label }}">
                Von Datum
            </label>
            {{ form.fortbildung_von_datum }}
            {% if form.fortbildung_von_datum.errors %}
            <div class="text-danger small mt-1">{{ form.fortbildung_von_datum.errors.0 }}</div>
            {% endif %}
        </div>

        <!-- Bis Datum -->
        <div class="mb-3">
            <label class="form-label fw-semibold" for="{{ form.fortbildung_bis_datum.id_for_label }}">
                Bis Datum
            </label>
            {{ form.fortbildung_bis_datum }}
            {% if form.fortbildung_bis_datum.errors %}
            <div class="text-danger small mt-1">{{ form.fortbildung_bis_datum.errors.0 }}</div>
            {% endif %}
        </div>

        <!-- Massnahmen-Nr -->
        <div class="mb-3">
            <label class="form-label fw-semibold" for="{{ form.fortbildung_massnahme_nr.id_for_label }}">
                Massnahmen-Nr
            </label>
            {{ form.fortbildung_massnahme_nr }}
            {% if form.fortbildung_massnahme_nr.errors %}
            <div class="text-danger small mt-1">{{ form.fortbildung_massnahme_nr.errors.0 }}</div>
            {% endif %}
        </div>

        <!-- Live-Berechnung -->
        <div id="berechnung-container"
             hx-post="{% url 'formulare:zeitgutschrift_fortbildung_berechnen' %}"
             hx-trigger="change from:[name='fortbildung_von_datum'], change from:[name='fortbildung_bis_datum'], change from:[name='fortbildung_wochenstunden_regulaer']"
             hx-include="[name='fortbildung_von_datum'], [name='fortbildung_bis_datum'], [name='fortbildung_wochenstunden_regulaer']"
             hx-swap="innerHTML">
            <!-- Wird per HTMX geladen -->
        </div>

        <!-- Belege-Upload (optional) -->
        <div class="mt-4">
            <h6 class="mb-2">Belege (optional)</h6>
            <p class="text-muted small mb-2">
                PDF, JPG oder PNG, max. 10 MB pro Datei
            </p>
            <input type="file" name="belege" class="form-control" multiple accept=".pdf,.jpg,.jpeg,.png">
            {% if form.belege.errors %}
            <div class="text-danger small mt-1">{{ form.belege.errors.0 }}</div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Fortbildungs-Felder anzeigen/verbergen bei Checkbox
document.addEventListener("DOMContentLoaded", function() {
    const checkbox = document.querySelector("[name='fortbildung_aktiv']");
    const felder = document.getElementById("fortbildung-felder");

    if (checkbox && felder) {
        checkbox.addEventListener("change", function() {
            felder.style.display = this.checked ? "block" : "none";
        });

        // Initial-Status
        if (checkbox.checked) {
            felder.style.display = "block";
        }
    }
});

// HTMX Event: Nach Art-Wechsel Checkbox neu binden
document.body.addEventListener("htmx:afterSwap", function(event) {
    if (event.detail.target.id === "felder-container") {
        const checkbox = document.querySelector("[name='fortbildung_aktiv']");
        const felder = document.getElementById("fortbildung-felder");

        if (checkbox && felder) {
            checkbox.addEventListener("change", function() {
                felder.style.display = this.checked ? "block" : "none";
            });
        }
    }
});
</script>

{% endif %}
